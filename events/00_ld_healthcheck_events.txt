namespace = ld

game_event = {
    id = ld.1100
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        if = {
            limit = { has_global_flag = ld_healthcheck_done }
            return = yes
        }
        set_global_flag = ld_healthcheck_done

        every_player = {
            # Rule presence sanity
            if = {
                limit = {
                    NOT = {
                        OR = {
                            has_game_rule = { name = ld_desync_mode value = ld_mp_safe }
                            has_game_rule = { name = ld_desync_mode value = ld_full }
                        }
                    }
                }
                send_interface_toast = {
                    type = event_toast_effect_bad
                    title = "LD Health Check"
                    desc = "Missing/invalid game rule: ld_desync_mode. Your save/modlist may not match."
                }
            }

            if = {
                limit = {
                    NOT = {
                        OR = {
                            has_game_rule = { name = ld_holy_war value = ld_holy_war_on }
                            has_game_rule = { name = ld_holy_war value = ld_holy_war_off }
                        }
                    }
                }
                send_interface_toast = {
                    type = event_toast_effect_bad
                    title = "LD Health Check"
                    desc = "Missing/invalid game rule: ld_holy_war. Your save/modlist may not match."
                }
            }

            # Missing interaction smoke test
            if = {
                limit = {
                    NOT = {
                        is_character_interaction_valid = {
                            interaction = call_dynasty_member_to_war_interaction
                            recipient = this
                        }
                    }
                }
                send_interface_toast = {
                    type = event_toast_effect_bad
                    title = "LD Health Check: Playset Issue"
                    desc = "Missing/invalid interaction: call_dynasty_member_to_war_interaction. If logs spam interaction errors, check load order / version mismatch / overrides."
                }
            }
        }
    }
}
